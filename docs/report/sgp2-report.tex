% GP2 SGP2 Report Draft (derived from provided UAEU CIT template)
% Cover-page metadata synchronized with GP1 team records and GP2 delivery scope.

\documentclass[12pt,a4paper]{report}

\usepackage{longtable}
\usepackage[english]{babel}
\usepackage[utf8]{inputenc}
\usepackage{listings}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage[colorinlistoftodos]{todonotes}
\usepackage{glossaries}
\usepackage{pdfpages}
\usepackage{natbib}
\usepackage{multirow}
\usepackage{xcolor}

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=black,
    filecolor=black,
    urlcolor=black,
    citecolor=black
}

\lstset{
  basicstyle=\ttfamily\small,
  breaklines=true,
  frame=single,
  columns=fullflexible,
  keepspaces=true
}

\begin{document}

\IfFileExists{acro.tex}{\include{acro}}{}
\pagenumbering{roman}

% -------------------------------------------------------------------------------------------
% COVER PAGE
% -------------------------------------------------------------------------------------------

\newcommand{\HRule}{\rule{\linewidth}{0.3mm}}
\begin{center}
\IfFileExists{Figures/CIT_logo.jpg}{\includegraphics[width=120mm]{Figures/CIT_logo.jpg}}{%
\fbox{\parbox{120mm}{\centering Place \texttt{CIT\_logo.jpg} in \texttt{docs/report/Figures/} to display the logo.}}}
\\ \vspace{0.7cm}
\textsc{\large \bfseries ITBP481: Senior Graduation Project II}\\ \vspace{0.3cm}
\textsc{\large \bfseries Final Project Report }\\ \vspace{0.3cm}
\textsc{Spring 2026} \\ \vspace{1.8cm}
\Large \textbf{Project Title: Smart Helmet Fatigue \& Crash Telemetry}\\ \vspace{0.3cm}
Project ID: Group 11 \\[0.6cm]

\begin{center}
\begin{tabular}{ c c c}
Suhail Khaled Alblooshi & 202230373 & Computer and Network Engineering\\
Mohammed Abdulla Alshamsi & 202107716 & Computer and Network Engineering\\
Ahmed Omar Mustafa & 700041219 & Computer and Network Engineering\\
Abdulla Salem Alshamsi & 202112121 & Computer and Network Engineering\\
\end{tabular}
\end{center}


\textbf{Project Advisor}: Dr. Mohammad Naouss \\ \vspace{1.3cm}

\textsc{\large \bfseries\textbf{A project report submitted in partial fulfillment of the requirements for the Bachelor of Science degree at the College of Information Technology, United Arab Emirates University}} \\ \vspace{1.3cm}
{\today}
\end{center}

\thispagestyle{empty}

\newpage
\setcounter{page}{1}

% ----------------------------------------------------------------------------------------------
% BEGINNING OF REPORT
% ----------------------------------------------------------------------------------------------

\section*{Executive Summary}

This project delivers a prototype ``smart helmet'' software stack that monitors driver/operator state and incident events in real time. The implemented solution integrates (1) fatigue detection based on eye aspect ratio (EAR) and a rolling closed-eye score (PERCLOS-style), (2) crash detection using an inertial measurement unit (IMU) high-$g$ threshold, and (3) cloud telemetry using MQTT for both periodic status updates and event-driven alerts. The final system is organized as modular Python components and includes unit and integration-style tests that can be executed on a development machine without physical Raspberry Pi hardware.

The primary outcome of SGP2 is a working end-to-end monitoring loop and a testable codebase. The fatigue detection module implements the EAR computation and a PERCLOS-like sliding window decision rule. Crash detection is implemented as a threshold on the acceleration magnitude $\sqrt{a_x^2+a_y^2+a_z^2}$, triggering a cloud alert when the threshold is exceeded. Testing is performed using Python \texttt{unittest} with mocking to validate runtime contracts, telemetry behavior, detection logic, and storage rules.

Compared with the broader GP1 concept (which included EEG and distraction/head-pose modules), SGP2 intentionally delivers an MVP-aligned scope focused on fatigue + crash + telemetry reliability. EEG and distraction analytics remain planned future extensions and are tracked in the project TODO roadmap.

Overall, the project demonstrates a practical and extensible foundation for safety monitoring. It highlights how embedded sensing, computer vision landmarks, and lightweight IoT messaging can be combined into a modular architecture that supports future improvements such as real landmark extraction (MediaPipe/dlib integration), calibrated thresholds, and on-device buffering for post-incident evidence.

\clearpage

\tableofcontents
\addcontentsline{toc}{section}{Table of contents}
\clearpage

\listoftables
\addcontentsline{toc}{section}{List of tables}
\clearpage

\listoffigures
\addcontentsline{toc}{section}{List of Figures}
\clearpage

\pagenumbering{arabic}

% ---------------------------------------------
\chapter{Introduction} \label{chapter:intro}

This report presents the final implementation and evaluation of a smart helmet prototype developed during Senior Graduation Project II (SGP2). The objective is to reduce safety risks by detecting fatigue and crash-like events and transmitting alerts and telemetry to a remote receiver. The project is motivated by the high societal and economic impact of fatigue-related incidents and the need for rapid detection and reporting of emergency events.

\section{Problem Statement}

Fatigue and delayed incident response are common contributors to avoidable accidents in transportation and field operations. A practical helmet-mounted system must operate with constrained compute resources, tolerate varying lighting conditions, and provide reliable signaling when potentially unsafe states are detected. The problem addressed in this project is how to design a modular embedded software pipeline that (1) estimates fatigue using visual cues from the eyes, (2) detects crash-like events using inertial sensing, and (3) communicates status and alerts via a lightweight telemetry protocol.

\section{Objectives}

The project objectives for SGP2 are as follows:

\begin{enumerate}
  \item Implement a modular software architecture with clear separation between sensing, detection, and telemetry.
  \item Implement fatigue detection using EAR and a rolling closed-eye score (PERCLOS-like) with configurable thresholds.
  \item Implement crash detection using IMU acceleration magnitude and a defined high-$g$ threshold.
  \item Implement telemetry publishing for periodic status and event-based alerts using MQTT.
  \item Validate correctness using unit and integration-style tests with repeatable expected outputs.
\end{enumerate}

\section{Final Outcomes and Deliverables}

By the end of SGP2, the project delivers:

\begin{itemize}
  \item A prototype runtime loop that integrates sensor acquisition, detection logic, and telemetry publishing.
  \item Implemented Python modules for sensors, fatigue detection, and MQTT telemetry.
  \item A unit test suite that executes on a development machine without physical hardware by using mocks and safe fallbacks.
  \item Documentation describing the architecture, components, testing strategy, and expected results (see \texttt{docs/}).
\end{itemize}

\section{GP1 Baseline to GP2 Delivery Scope}

The GP1 report established a broad solution vision covering fatigue, distraction, EEG-assisted monitoring, event buffering, cloud telemetry, and dashboard analytics. During GP2, delivery priorities were narrowed to a stable MVP path focused on fatigue detection, crash detection, and telemetry reliability on a constrained embedded setup.

This scope control was intentional and risk-driven: it enabled completion of an end-to-end validated runtime loop and repeatable automated testing while preserving expansion paths for deferred capabilities. Specifically, distraction/head-pose fusion and EEG integration remain part of the post-submission roadmap and are tracked in project TODO and implementation-roadmap documents.

\section{Motivation and Relevance}

From a safety perspective, early fatigue detection can support timely interventions that reduce accident probability, while crash event detection can shorten response time by sending alerts immediately after a high-$g$ incident. The relevance of this work aligns with regional road-safety priorities and with broader industrial needs for low-cost monitoring of operator state and incident events. The proposed software design is also educationally relevant: it demonstrates system integration across sensing, signal processing, and IoT communication.

\section{Report Structure Summary}

Chapter~\ref{chapter:standards} discusses the professional standards and constraints considered during development. Chapter~\ref{chapter:system-design} presents the system design and integration, including modules and technologies used. Chapter~\ref{chapter:implementation} details implementation, testing strategy, and results analysis. Chapter~\ref{chapter:project-management} summarizes project management and teamwork reflections. Chapter~\ref{chapter:conclusion} concludes the report and recommends future improvements.

% ---------------------------------------
\clearpage
\chapter{Professional Standards and Practice Constraints} \label{chapter:standards}

This project was developed under constraints typical of embedded/IoT systems, including hardware availability, compute limitations, and safety considerations. Professional practice emphasizes reliability, transparency, and responsible handling of sensor and telemetry data.

\section{Economic Constraints}

The design prioritizes low-cost components and open-source tooling to keep the bill of materials and development cost manageable. The software was implemented in Python to accelerate prototyping and to reduce engineering time, with the understanding that performance-critical portions could be optimized or migrated to lower-level languages in future work.

\section{Environmental Constraints}

The proposed system is intended for battery-powered operation, so compute and radio usage should be efficient. The current prototype includes modeled power estimates in telemetry, but does not yet include measured on-device current profiling. MQTT is selected because it is lightweight compared to many HTTP-based approaches. Future iterations should quantify energy consumption with instrumented measurements and evaluate duty-cycling strategies.

\section{Health, Safety, and Security}

Health and safety considerations include ensuring that alerts are conservative and do not induce distraction or overconfidence. The system should be treated as an assistive tool rather than a sole safety mechanism. Security considerations include protecting telemetry confidentiality and integrity. The current prototype uses a public MQTT broker for development; a production system should use authentication, TLS, and private broker infrastructure.

\section{Social, Cultural, and Political Constraints}

The project is relevant to the UAE context where road safety and rapid emergency response are strategic priorities. The solution must also be usable across varied environments (day/night, different users) and should avoid bias by validating performance across diverse participants and conditions.

\section{Ethical and Legal Compliance}

The system concept may involve camera-based monitoring, which raises privacy considerations. Ethical compliance requires minimizing data retention, avoiding unnecessary storage of identifiable video, and obtaining informed consent during data collection. Any future deployment should comply with applicable data protection requirements and institutional guidelines.

% -----------------------------------------
\clearpage
\chapter{System Design and Integration} \label{chapter:system-design}

\section{System Modules, Components, and Setup}

The final prototype is organized as a modular pipeline with four primary layers: sensors, detection, telemetry, and orchestration.

\subsection*{Sensors layer}

The sensors layer includes: (1) an IMU interface that reports acceleration on three axes, (2) a camera interface for frame capture, and (3) an IR LED controller to support low-light conditions. For development convenience, the sensor wrappers include safe fallbacks so the software can be imported and tested without Raspberry Pi hardware.

\subsection*{Detection layer}

The fatigue detector computes the eye aspect ratio (EAR) from eye landmarks and maintains a rolling buffer of closed-eye indicators to approximate a PERCLOS-like metric. Crash detection is implemented as a threshold on acceleration magnitude.

\subsection*{Telemetry layer}

Telemetry is published over MQTT to separate topics for status and alerts. MQTT is suitable for constrained devices due to its low overhead and publish/subscribe semantics \citep{mqtt_oasis}.

\subsection*{Orchestration}

The orchestration loop coordinates sensor sampling, detection logic, and telemetry publishing at a fixed interval.

\begin{figure}[h]
\centering
\fbox{\parbox{0.9\linewidth}{\centering
\textbf{Architecture diagram summary.}\\
The system consists of Sensors $\rightarrow$ Detection $\rightarrow$ Telemetry, coordinated by a main loop.
}}
\caption{High-level system architecture of the smart helmet prototype.}
\label{fig:system_architecture}
\end{figure}

\section{Technologies and Standards Applied}

The implementation uses:

\begin{itemize}
  \item Python 3 for rapid prototyping.
  \item NumPy for numeric operations and array handling \citep{numpy_docs}.
  \item OpenCV (optional) for camera frame capture \citep{opencv_docs}.
  \item MediaPipe for optional runtime face/eye landmark extraction \citep{mediapipe_docs}.
  \item MQTT for telemetry topics and event alerts \citep{mqtt_oasis}.
  \item SQLite (standard library) for local retention and offline replay buffering.
  \item Optional hardware drivers: \texttt{smbus2} (I2C) and \texttt{RPi.GPIO} (PWM/GPIO).
  \item Python \texttt{unittest} and \texttt{unittest.mock} for automated testing.
\end{itemize}

\section{Challenges and Solutions}

Key challenges during development included hardware-specific dependencies and the need to run tests on non-embedded machines. This was addressed by implementing optional imports and lightweight stubs for I2C/GPIO and camera interfaces, allowing unit tests to run without physical devices. Another challenge is that accurate fatigue detection requires robust landmark extraction under varied conditions; the current runtime supports frame-based landmark extraction when optional dependencies are available, while tests use controlled mocks/injection to validate logic and integration contracts.

% ----------------------------------
\clearpage
\chapter{Implementation, Testing, and Results Analysis}
\label{chapter:implementation}

\section{Implementation Summary}

The final implementation is delivered as a Python runtime package under \texttt{src/gp2/} with tests under \texttt{tests/}. The orchestration script initializes the IMU, camera, IR controller, telemetry client, and fatigue detector, then iterates in a timed loop. In each iteration, acceleration is read and converted to total $g$ magnitude; if a high-$g$ threshold is exceeded, a crash alert is published. Separately, the fatigue detector is invoked to compute EAR and update the rolling closed-eye buffer; if fatigue is detected, a fatigue alert is published. Periodic telemetry publishes status data including PERCLOS, acceleration magnitude, sensor-health state, power-profile estimates, and AI-metric fields.

\section{Testing Strategy and Process}

Testing is performed with a focus on repeatability and isolation. The project uses unit tests and integration-style tests within Python \texttt{unittest}. Hardware interactions are replaced with mocks to ensure tests can execute on a laptop environment.

\subsection*{Objective-to-implementation traceability}

Table~\ref{tab:objective_traceability} maps the major SGP2 objectives to implementation artifacts and validation evidence.

\begin{table}[h]
\centering
\caption{Objective-to-implementation traceability.}
\label{tab:objective_traceability}
\begin{tabular}{|p{0.24\textwidth}|p{0.36\textwidth}|p{0.28\textwidth}|}
\hline
\textbf{Objective} & \textbf{Implementation evidence} & \textbf{Validation evidence} \\ \hline
Modular architecture & Runtime orchestration contract, separated sensing/detection/telemetry modules under \texttt{src/gp2/} & Contract-cycle test and module-level unit tests \\ \hline
Fatigue detection & EAR + rolling PERCLOS logic in \texttt{detection.py} & Fatigue trigger tests and runtime metric fields \\ \hline
Crash detection & High-$g$ threshold on acceleration magnitude in orchestration cycle & Crash integration test with mocked IMU event \\ \hline
Telemetry publishing & MQTT alert/status client with QoS policy and offline queue behavior & Telemetry payload, QoS, and offline-queue tests \\ \hline
Repeatable validation & Automated \texttt{unittest} suite and reproducible execution command & Full suite pass in development environment \\ \hline
\end{tabular}
\end{table}

\subsection*{Unit testing}

Unit tests validate individual components:

\begin{itemize}
  \item IMU data formatting: verifies that the IMU wrapper returns a three-element tuple.
  \item Fatigue trigger logic: verifies that a drowsiness condition is reported when EAR is below threshold (validated via injection).
  \item Telemetry behavior: verifies payload-shape, QoS routing, and offline-queue placeholder behavior under disconnected transport assumptions.
  \item Storage behavior: verifies local retention pruning and replay-related policy hooks.
\end{itemize}

\subsection*{Integration-style testing}

An integration-style test validates crash detection wiring by simulating an IMU measurement exceeding the threshold and asserting that an alert publish call is made.

\begin{table}[h]
\centering
\caption{Summary of implemented automated tests and expected outcomes.}
\label{tab:test_summary}
\begin{tabular}{|l|l|l|}
\hline
\textbf{Test} & \textbf{Component/Functionality} & \textbf{Expected Outcome} \\ \hline
\texttt{test\_imu\_connection} & IMU wrapper return format & Returns 3-tuple; test passes \\ \hline
\texttt{test\_fatigue\_logic} & Fatigue trigger condition & Drowsy=True with EAR<0.25; test passes \\ \hline
\texttt{test\_crash\_integration} & Crash threshold \& alert wiring & Alert publish invoked for total\_g>2.5; test passes \\ \hline
\texttt{test\_offline\_queue\_placeholder\_behavior} & Connectivity fallback queueing & Messages are queued while transport is unavailable \\ \hline
\texttt{test\_storage\_retention\_pruning} & Local retention enforcement & Records older than retention window are pruned \\ \hline
\texttt{test\_software\_architecture\_contract\_cycle} & End-to-end runtime cycle contract & Crash/fatigue/status events emitted in one cycle \\ \hline
\end{tabular}
\end{table}

\section{Results and Analysis}

The automated test suite passes successfully in the development environment and currently executes 22 automated tests. Coverage includes IMU formatting, fatigue/crash trigger behavior, connectivity policy, local storage retention/replay rules, and orchestrator contracts. The verbose test output includes explicit ``[Pass]'' statements for key scenarios, enabling straightforward verification during demonstrations. The results support the core objective of validating the correctness of detection triggers and integration wiring.

However, these results do not measure real-world accuracy, sensitivity, or false-positive rates. In particular, the fatigue detection module is not yet evaluated with real landmark extraction and real video sequences. Therefore, the current results are interpreted as evidence of correct implementation structure and basic logic, rather than clinical or production-grade fatigue detection performance.

\section{Potential Improvements}

Several improvements are recommended for future work:

\begin{itemize}
  \item Integrate a real facial landmark pipeline (e.g., MediaPipe FaceMesh) and map indices to the EAR computation.
  \item Calibrate thresholds (EAR and PERCLOS) using recorded datasets under varied lighting and across multiple users.
  \item Add end-to-end tests that run the orchestration loop for a fixed duration and verify telemetry publishes using a local MQTT broker.
  \item Add security features for telemetry such as TLS and authentication and migrate away from public brokers.
  \item Add power profiling and performance measurement on the target device.
\end{itemize}

% ------------------------------
\clearpage
\chapter{Project Management and Teamwork Reflection} \label{chapter:project-management}

Project execution followed an iterative workflow with milestones for module implementation, integration, and testing. The management approach evolved from the GP1 design/planning timeline into a focused GP2 implementation and validation track.

\section{Tasks and Schedule (Gantt Summary)}

The project schedule used a milestone-oriented sequence aligned with the GP1 plan structure and adapted for GP2 delivery priorities.

\begin{table}[h]
\centering
\caption{Milestone schedule adapted from GP1 planning to GP2 execution.}
\label{tab:gantt_milestones}
\begin{tabular}{|p{0.16\textwidth}|p{0.17\textwidth}|p{0.52\textwidth}|}
\hline
\textbf{Milestone} & \textbf{Window} & \textbf{Key output} \\ \hline
M1: Requirements \& design freeze & Weeks 1--2 & Finalized target metrics, privacy baseline, and MVP scope boundaries \\ \hline
M2: Hardware bring-up & Weeks 3--5 & Sensor interface verification and startup health checks \\ \hline
M3: Perception v1 & Weeks 6--9 & EAR/PERCLOS heuristic pipeline and detector integration \\ \hline
M4: Event buffering \& telemetry & Weeks 10--12 & Status/alert topics, QoS policy, and local buffer hooks \\ \hline
M5: Field tuning \& fusion & Weeks 13--16 & Threshold tuning and false-alert reduction iterations \\ \hline
M6: Privacy \& governance & Weeks 17--18 & Retention and consent constraints reflected in documentation and policy \\ \hline
M7: Power/thermal hardening & Weeks 19--21 & Power profile model and runtime budget checks \\ \hline
M8: Demo-ready integration & Weeks 22--24 & End-to-end validated prototype and final report packaging \\ \hline
\end{tabular}
\end{table}

\section{Team Organization and Resource Allocation}

Table~\ref{tab:team_allocation} summarizes the role allocation derived from GP1 planning and maintained through GP2 implementation.

\begin{table}[h]
\centering
\caption{Team organization and resource allocation.}
\label{tab:team_allocation}
\begin{tabular}{|p{0.28\textwidth}|p{0.25\textwidth}|p{0.32\textwidth}|}
\hline
\textbf{Member} & \textbf{Primary role} & \textbf{Representative deliverables} \\ \hline
Suhail Khaled Alblooshi (202230373) & Hardware \& integration & Sensor bring-up support, power/thermal checks, integration validation \\ \hline
Mohammed Abdulla Alshamsi (202107716) & Edge AI \& embedded software & Fatigue/crash runtime pipeline, detector integration, runtime behavior tuning \\ \hline
Ahmed Omar Mustafa (700041219) & Cloud/telemetry integration & MQTT status/alert path, payload contracts, storage/connectivity alignment \\ \hline
Abdulla Salem Alshamsi (202112121) & QA/documentation/compliance & Test planning/execution, report consolidation, privacy/compliance documentation \\ \hline
\end{tabular}
\end{table}

\section{Resources used During the Project}

Resources used include Python documentation, MQTT specification \citep{mqtt_oasis}, and open-source libraries such as NumPy \citep{numpy_docs}. Additional resources include tutorials and vendor datasheets for IMU and Raspberry Pi interfacing.

\section{Remaining Implementation Plan (Post-Submission Roadmap)}

The remaining open work is tracked in the project TODO files under \texttt{docs/todo/} and consolidated in \texttt{docs/IMPLEMENTATION\_ROADMAP.md}. The planned sequence is organized into four short sprints: (1) requirements freeze and platform scope finalization, (2) connectivity hardening and fault-recovery policy, (3) storage/privacy hardening with schema and encryption controls, and (4) AI dataset labeling and benchmark validation.

This staged plan keeps the current MVP stable while enabling incremental expansion toward the broader GP1 vision (including distraction and EEG-related extensions). Each sprint requires synchronized updates to code, tests, checklist status, and report sections to preserve traceability.

% --------------------------------------------
\clearpage
\chapter{Conclusion and Future Recommendations} \label{chapter:conclusion}

This report presented a modular smart helmet prototype implementing fatigue detection, crash detection, and MQTT-based telemetry. The project achieved a complete software integration loop and a repeatable automated test suite that validates core triggers and event wiring. The main limitation is the absence of a full landmark extraction pipeline and quantitative evaluation on real data. Future work should prioritize integrating real facial landmarks, conducting controlled experiments to calibrate thresholds, and strengthening telemetry security for realistic deployment.

% -----------------------------------
\clearpage
\chapter{Statement of Contribution}
\label{chapter:Contribution}

This chapter summarizes contribution distribution by major workstream for the GP2 delivery phase.

\begin{table}[h]
\centering
\caption{Student contribution distribution during SGP2.}
\label{tab:student_contribution}

\begin{tabular}{|c|c|c|}
\hline
\textbf{Task} & \textbf{Student ID} & \textbf{Contribution Percentage} \\ \hline
T1: Architecture \& Integration & 202230373 & 25\% \\ \hline
T2: Detection Module \& Thresholds & 202107716 & 25\% \\ \hline
T3: Telemetry/Validation Support & 700041219 & 25\% \\ \hline
T4: Documentation \& Compliance & 202112121 & 25\% \\ \hline
\end{tabular}
\end{table}

\begin{table}[h!]
\centering
\caption{Student Signatures}
\label{tab:signatures}
\small
\begin{tabular}{|p{0.18\textwidth}|p{0.4\textwidth}|p{0.2\textwidth}|}
\hline
\textbf{Student ID} & \textbf{Student Name} & \textbf{Signature} \\ \hline
202230373 & Suhail Khaled Alblooshi &  \\ \hline
202107716 & Mohammed Abdulla Alshamsi &  \\ \hline
700041219 & Ahmed Omar Mustafa &  \\ \hline
202112121 & Abdulla Salem Alshamsi &  \\ \hline
\end{tabular}
\end{table}

% ----------------------------
\newpage
\renewcommand{\bibname}{References}
\bibliographystyle{unsrt}
\bibliography{references}

% --------------------------
\newpage
\section*{Appendix (Optional)}

\subsection*{A.1 Test execution output}

The following is an example of the expected console output from running the unit tests in verbose mode:

\begin{lstlisting}
python -m unittest tests/test_runtime.py -v

test_crash_integration (tests.TestSmartHelmet.test_crash_integration)
Crash threshold integration path ...
[Pass] Crash Integration (Sensor -> Cloud Trigger) Verified
ok

test_fatigue_logic (tests.TestSmartHelmet.test_fatigue_logic)
Fatigue logic simulation (software injection) ...
[Pass] Fatigue Logic Triggered Correctly
ok

test_imu_connection (tests.TestSmartHelmet.test_imu_connection)
Verify IMU reads data format correctly ...
[Pass] IMU Data Format Verified
ok

... additional connectivity/storage/architecture/AI tests ...

----------------------------------------------------------------------
Ran 22 tests in ~0.4s

OK
\end{lstlisting}

\end{document}
